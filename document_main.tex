\documentclass[12pt,a4paper]{report}

% -----------------------------
% Packages
% -----------------------------
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{hyperref}
\usepackage{bookmark}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{tocloft}
\usepackage{geometry}
\usepackage{setspace}

% Add spacing between numbers and titles in TOC, LOF, LOT
\setlength{\cftchapnumwidth}{3em}
\setlength{\cftsecnumwidth}{3em}
\setlength{\cftsubsecnumwidth}{4em}
\setlength{\cftfignumwidth}{3em}
\setlength{\cfttabnumwidth}{3em}

% Fix section numbering to display correctly (8.1, 8.2 instead of 8.32, 8.33)
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

% Fix figure and table numbering to reset with each chapter
\renewcommand{\thefigure}{\thechapter.\arabic{figure}}
\renewcommand{\thetable}{\thechapter.\arabic{table}}
\usepackage{chngcntr}
\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
\usepackage{array}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{booktabs}
\usepackage{float}
\usepackage{lscape}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{amssymb}
\usepackage{tcolorbox}
\usepackage{tikz}
\usetikzlibrary{positioning,arrows,shapes,shadows}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{pgf-pie}
\usepackage{framed}
\usepackage{mdframed}
\usepackage{fancyhdr}  % For headers and footers
\usepackage{lettrine}  % For drop caps
\usepackage{lmodern}   % Ensure fonts are scalable
\usepackage{environ}

% -----------------------------
% Professional Color Palette
% -----------------------------
\definecolor{primaryBlue}{RGB}{41, 98, 155}      % Soft professional blue
\definecolor{accentBlue}{RGB}{52, 152, 219}      % Brighter accent
\definecolor{darkNavy}{RGB}{25, 60, 95}          % Darker navy for subsections
\definecolor{darkGray}{RGB}{64, 64, 64}          % Dark gray for text
\definecolor{lightGray}{RGB}{245, 245, 245}      % Light gray backgrounds
\definecolor{sectionBg}{RGB}{240, 248, 255}      % Very light blue for sections
\definecolor{chapterBg}{RGB}{250, 248, 245}     % Light beige for chapter titles
\definecolor{lettrineOptions}{HTML}{06609f}      % User specified lettrine color

% Configure lettrine for drop caps with refined professional styling
\renewcommand{\LettrineFontHook}{\color{lettrineOptions}\bfseries}
\renewcommand{\DefaultNindent}{0pt}
\renewcommand{\DefaultLoversize}{0.15}  % Slightly raise the drop cap
\renewcommand{\DefaultLraise}{0}        % No additional raise
\renewcommand{\DefaultLhang}{0.1}       % Small hang into margin for elegance

% Define custom colors for JSON
\definecolor{jsonkey}{HTML}{FFC000}
\definecolor{jsonvalue}{HTML}{00B050}
\definecolor{jsonnumber}{HTML}{9B42D2}

% Configure listings for JSON
\lstdefinelanguage{json}{
    basicstyle=\ttfamily\small,
    numbers=none,
    breaklines=true,
    frame=single,
    showstringspaces=false,
    literate=
     *{0}{{{\color{jsonnumber}0}}}{1}
      {1}{{{\color{jsonnumber}1}}}{1}
      {2}{{{\color{jsonnumber}2}}}{1}
      {3}{{{\color{jsonnumber}3}}}{1}
      {4}{{{\color{jsonnumber}4}}}{1}
      {5}{{{\color{jsonnumber}5}}}{1}
      {6}{{{\color{jsonnumber}6}}}{1}
      {7}{{{\color{jsonnumber}7}}}{1}
      {8}{{{\color{jsonnumber}8}}}{1}
      {9}{{{\color{jsonnumber}9}}}{1}
      {:}{{{\color{black}:}}}{1}
      {,}{{{\color{black},}}}{1}
      {\{}{{{\color{black}\{}}}{1}
      {\}}{{{\color{black}\}}}}{1}
      {[}{{{\color{black}[}}}{1}
      {]}{{{\color{black}]}}}{1},
    moredelim=**[is][\color{jsonkey}]{\%key\%}{\%},
    moredelim=**[is][\color{jsonvalue}]{\%val\%}{\%},
}

\geometry{margin=1in}
\onehalfspacing

% -----------------------------
% Page Headers and Footers
% -----------------------------
\pagestyle{fancy}
\fancyhf{} % Clear all headers and footers
\fancyhead[L]{\small\textcolor{primaryBlue}{\nouppercase{\leftmark}}}
\fancyhead[R]{\includegraphics[height=0.5cm]{images/cover_page_logo.png}}
\fancyfoot[C]{\small\textcolor{primaryBlue}{\thepage}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{primaryBlue}\leaders\hrule height \headrulewidth\hfill}}

% Plain style for chapter pages
\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyfoot[C]{\small\textcolor{primaryBlue}{\thepage}}
  \renewcommand{\headrulewidth}{0pt}
}

% -----------------------------
% Enhanced Section Formatting
% -----------------------------
% Chapter formatting - title in light beige box without outline
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\color{primaryBlue}}
  {\chaptertitlename\ \thechapter}
  {20pt}
  {%
    \begin{mdframed}[
      linewidth=0pt,
      backgroundcolor=chapterBg,
      roundcorner=8pt,
      innertopmargin=15pt,
      innerbottommargin=15pt,
      innerrightmargin=20pt,
      innerleftmargin=20pt,
      skipabove=10pt,
      skipbelow=10pt
    ]
    \centering\huge\bfseries\color{primaryBlue}
  }
  [\end{mdframed}]

% Section formatting - with colored box for number and beige background, starts on new page
\titleformat{\section}
  {\clearpage\normalfont\Large\bfseries\color{primaryBlue}}
  {\colorbox{primaryBlue}{\makebox[2em][c]{\textcolor{white}{\thesection}}}}
  {0.8em}
  {}
  [\vspace{-1.8ex}{\colorbox{chapterBg}{\parbox{\dimexpr\textwidth-2\fboxsep}{\vspace{0.3ex}\color{primaryBlue}\titlerule[0.8pt]\vspace{0.3ex}}}}]

% Subsection formatting - clean with colored number
\titleformat{\subsection}
  {\normalfont\large\bfseries\color{darkNavy}}
  {\textcolor{darkNavy}{\thesubsection}}
  {0.8em}
  {}

% Subsubsection formatting
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries\color{darkNavy}}
  {\textcolor{darkNavy}{\thesubsubsection}}
  {0.8em}
  {}

% Adjust spacing around sections
\titlespacing*{\chapter}{0pt}{0pt}{30pt}
\titlespacing*{\section}{0pt}{20pt}{12pt}
\titlespacing*{\subsection}{0pt}{15pt}{8pt}
\titlespacing*{\subsubsection}{0pt}{12pt}{6pt}

% -----------------------------
% Lettrine helper
% -----------------------------
% Helper macro to split the first word: #1=first letter, #2=rest of word, #3=rest of body
\long\def\formatLettrineHelpers#1#2 #3\relax{%
  \lettrine[lines=2,lhang=0,nindent=0em,findent=0.1em,loversize=0.5,lraise=0]{#1}{#2} #3%
}

% -----------------------------
% Section Intro Page Environment
% -----------------------------
\NewEnviron{sectionintro}[3]{%
  % #1 = Chapter number
  % #2 = Chapter title
  % #3 = Bullet points for "This part covers:"
  \clearpage
  \phantomsection  % Creates a proper anchor for hyperlinks
  \addcontentsline{toc}{chapter}{\numberline{#1}#2}  % Add to TOC
  \setcounter{chapter}{#1}  % Set chapter counter for section numbering
  \setcounter{section}{0}  % Reset section counter for new chapter
  \setcounter{figure}{0}  % Reset figure counter for new chapter
  \setcounter{table}{0}  % Reset table counter for new chapter
  \markboth{Chapter #1: #2}{Chapter #1: #2}  % Set chapter marks for headers
  \thispagestyle{empty}
  \vspace*{3cm}
  
  % Create a TikZ overlay for the large "Chapter X" on the right
  \begin{tikzpicture}[remember picture,overlay]
    \node[
      anchor=north east,
      xshift=-2cm,
      yshift=-4cm,
      opacity=0.3,
      text=darkGray
    ] at (current page.north east) {%
      \fontsize{30}{30}\selectfont\bfseries Chapter #1%
    };
  \end{tikzpicture}
  
  % Title with underline
  \noindent
  {\Huge\color{primaryBlue}\textbf{#2}}\\[0.5cm]
  {\color{primaryBlue}\rule{\textwidth}{2pt}}
  
  \vspace{1.5cm}
  
  % "This part covers" section in beige box on the left
  \noindent
  \begin{minipage}{0.6\textwidth}
    \begin{mdframed}[
      linewidth=0pt,
      backgroundcolor=chapterBg,
      roundcorner=8pt,
      innertopmargin=15pt,
      innerbottommargin=15pt,
      innerrightmargin=20pt,
      innerleftmargin=20pt,
      skipabove=0pt,
      skipbelow=0pt
    ]
      {\large\color{primaryBlue}\textit{This part covers:}}\\[0.4cm]
      \color{darkGray}
      #3
    \end{mdframed}
  \end{minipage}
  
  \vspace{1.5cm}
  
  \noindent
  % Apply lettrine to the captured body
  \expandafter\formatLettrineHelpers\BODY\relax
  \par
}

% clickable links formatting
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    citecolor=blue
}

% -----------------------------
% DOCUMENT START
% -----------------------------
\begin{document}

% --------------------------------
% Cover Page
% --------------------------------
\begin{titlepage}
    \centering
    
    % University Logo
    \vspace*{0.2cm}
    \includegraphics[width=0.18\textwidth]{images/university-logo.png}\\[0.4cm]
    
    % University Name and Department
    {\LARGE \textbf{Ain Shams University}}\\[0.15cm]
    {\Large \textbf{Faculty of Engineering}}\\[0.15cm]
    {\large Computer and Systems Engineering Department}\\[0.8cm]

    \includegraphics[width=0.18\textwidth]{images/cover_page_logo.png}\\[0.5cm]
    
    % Decorative Line
    {\color{black!60}\rule{0.8\textwidth}{2pt}}\\[0.6cm]
    
    % Project Title
    {\Huge \textbf{zGate Gateway}}\\[0.3cm]
    {\LARGE {A Zero Trust Database Access Proxy}}\\[0.5cm]
    
    % Decorative Line
    {\color{black!60}\rule{0.8\textwidth}{2pt}}\\[0.6cm]
    
    % Document Type
    {\Large \textsc{Graduation Project Documentation}}\\[0.2cm]
    {\large Computer Engineering}\\[0.8cm]
    
    % Supervisor Section
    \begin{minipage}{0.8\textwidth}
        \centering
        \textbf{Supervised by:}\\[0.2cm]
        {\large Dr. Mohammed Sobh}\\[0.1cm]
        {\normalsize Computer and Systems Engineering Department}
    \end{minipage}\\[0.6cm]
    
    \vfill
    
    % Academic Year at Bottom
    {\color{blue!60}\rule{0.8\textwidth}{1pt}}\\[0.15cm]
    {\Large Academic Year 2025–2026}\\[0.15cm]
    {\color{blue!60}\rule{0.8\textwidth}{1pt}}
    
\end{titlepage}
% --------------------------------
% Acknowledgments
% --------------------------------
\chapter*{Acknowledgments}
We would like to express our deepest gratitude to our supervisor, \textbf{Dr. Mohammed Sobh}, for his unwavering support, guidance, and dedication throughout this project. His commitment to engaging with us in weekly meetings, providing constructive feedback, and sharing his expertise in software architecture and security systems was instrumental in shaping zGate into what it is today. We are truly fortunate to have had such an invested and accessible supervisor.

We extend our heartfelt thanks to our mentors, \textbf{Eng. Fady Khallaf} and \textbf{Eng. Kirollos Magdy}, whose contributions to our journey cannot be overstated. From the very beginning, they helped us understand the problem statement, guided us on how to approach the project methodically, and provided invaluable study materials that accelerated our learning. Their participation in our weekly meetings, where they identified our weak spots and helped us address them, was essential to our growth as engineers. Their patience, encouragement, and technical insights made a profound difference in both our project outcomes and our professional development.

We also wish to acknowledge the \textbf{Faculty of Engineering at Ain Shams University} and the \textbf{Computer and Systems Engineering Department} for providing the academic foundation and resources that made this project possible.

Finally, we express our sincere appreciation to our families and friends for their patience, encouragement, and support throughout this demanding journey. Their belief in us kept us motivated during the challenging moments of development and documentation.

\newpage

% --------------------------------
% Abstract
% --------------------------------
\chapter*{Abstract}
Traditional database access management relies on shared credentials and static permissions, creating significant security vulnerabilities including credential sprawl, lack of individual accountability, and insider threat exposure. Existing solutions such as VPNs, bastion hosts, and privileged access management systems fail to address the fundamental problem: users still handle production database credentials, which can be extracted, shared, or misused.

This project presents zGate, a Zero Trust Database Access Gateway that fundamentally transforms database security by eliminating direct credential exposure. zGate operates as an intelligent proxy layer between users and databases, intercepting traffic at the wire protocol level to enforce identity-based access control, generate session-specific credentials, and provide comprehensive audit logging with full user attribution.

The system comprises three integrated components: a high-performance Go-based gateway server implementing MySQL wire protocol support with transparent credential injection; a cross-platform command-line interface with secure keyring integration for macOS, Windows, and Linux; and a React-based web administration dashboard for managing users, roles, databases, and monitoring active sessions.

Key security features include JWT-based authentication with short-lived access tokens and automatic refresh, role-based access control with database-level permissions, a composable interceptor pipeline for query safety enforcement and dynamic data masking, and immutable audit trails capturing every database operation.

The Term~1 prototype demonstrates functional Zero Trust database access where users authenticate with organizational identities and connect to MySQL databases without ever seeing or handling production credentials. The architecture validates that Zero Trust principles---never trust, always verify, assume breach---can be practically implemented at the database protocol level while maintaining developer productivity, establishing a foundation for production deployment in Term~2.

\newpage

% --------------------------------
% Table of Contents
% --------------------------------
\tableofcontents
\newpage

% --------------------------------
% List of Figures
% --------------------------------
\listoffigures
\newpage

% --------------------------------
% List of Tables
% --------------------------------
\listoftables
\thispagestyle{plain}
\newpage

% ============================================================
% MAIN CONTENT - CHAPTERS
% ============================================================
\input{chapters/01_team_information}
\input{chapters/02_introduction}
\input{chapters/03_project_definition}
\input{chapters/04_requirements}
\input{chapters/05_proposed_solution}
\input{chapters/06_standards}
\input{chapters/07_competitor_analysis}
\input{chapters/08_literature_review}
\input{chapters/09_technical_background}
\input{chapters/10_system_architecture}
\input{chapters/11_proxy_architecture}
\input{chapters/13_technology_justification}
\input{chapters/14_prototype}
\input{chapters/15_methodology}
\input{chapters/17_milestones}
\input{chapters/18_risk_analysis}
\input{chapters/19_roadmap_term2}
\input{chapters/20_team_contribution}
\input{chapters/22_conclusion}

% ============================================================
% REFERENCES
% ============================================================
% Let the thebibliography environment print the heading named "References"
\renewcommand{\bibname}{References}
\begin{thebibliography}{99}
\bibitem{nist-zt}
M. Rose et al., "Zero Trust Architecture", NIST Special Publication 800-207, 2020. Available: https://www.nist.gov/publications/zero-trust-architecture

\bibitem{nist-key}
NIST, "Recommendation for Key Management" (SP 800-57), NIST, 2020. https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final

\bibitem{owasp-sql}
OWASP Foundation, "SQL Injection", OWASP Top Ten Project, https://owasp.org/www-community/attacks/SQL_Injection

\bibitem{db-engines}
S. Ding, "DB-Engines Ranking", DB-Engines, ongoing. https://db-engines.com/en/ranking

\bibitem{mysql-proto}
Oracle, "MySQL Internals — Client/Server Protocol", MySQL Reference Manual. https://dev.mysql.com/doc/internals/en/client-server-protocol.html

\bibitem{postgres-proto}
PostgreSQL Global Development Group, "Frontend/Backend Protocol", PostgreSQL Documentation. https://www.postgresql.org/docs/current/protocol.html

\bibitem{tds}
Microsoft Docs, "Tabular Data Stream (TDS) Protocol", Microsoft. https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tds

\bibitem{tls13}
E. Rescorla, "The Transport Layer Security (TLS) Protocol Version 1.3", RFC 8446, 2018. https://tools.ietf.org/html/rfc8446

\bibitem{vault}
HashiCorp, "Vault — Secrets Management", HashiCorp Documentation. https://www.vaultproject.io/docs

\bibitem{teleport}
Gravitational, "Teleport — Secure Access for SSH and Kubernetes", Teleport Documentation. https://goteleport.com/docs/

\bibitem{hoop}
Hoop, "Hoop — secure database access" (product site), https://hoop.dev/

\bibitem{db-security-book}
R. Anderson, "Security Engineering: A Guide to Building Dependable Distributed Systems", 3rd ed., Wiley, 2020. (covers secure system and data design principles)

\bibitem{nist-controls}
NIST, "Security and Privacy Controls for Information Systems and Organizations", NIST SP 800-53 Rev. 5. https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final

\bibitem{react-docs}
React Core Team, "React – A JavaScript library for building user interfaces", https://reactjs.org/

\bibitem{typescript-docs}
Microsoft, "TypeScript: JavaScript with syntax for types", https://www.typescriptlang.org/

\bibitem{nextjs-docs}
Vercel, "Next.js Documentation", https://nextjs.org/docs

\bibitem{tailwind-docs}
Tailwind Labs, "Tailwind CSS Documentation", https://tailwindcss.com/docs

\bibitem{market-statista}
Statista, "Database Management Systems – Market size and forecasts", Statista Research, https://www.statista.com/

\bibitem{worldbank-egypt}
World Bank, "Egypt — Digital Development and ICT Reports", World Bank Data and Reports. https://data.worldbank.org/country/egypt

\bibitem{mcit-egypt}
Ministry of Communications and Information Technology (MCIT) Egypt, "ICT Indicators and Reports", https://mcit.gov.eg/

\bibitem{teleport-blog}
Gravitational, "How Teleport secures database access — blog and architecture notes", https://goteleport.com/blog/

\bibitem{ibm-security}
IBM Security, "Database Security: Best Practices", IBM Documentation and whitepapers. https://www.ibm.com/security

\end{thebibliography}

% ============================================================
% APPENDICES
% ============================================================
\input{chapters/appendices}

\end{document}
